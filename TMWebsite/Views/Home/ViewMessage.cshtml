
@{
    ViewBag.Title = "Danh sách chi tiết tin nhắn";
    Layout = "~/Views/Shared/_LayoutIndex.cshtml";
}

<div class="row">
    <div class="col-sm-12">
        <div class="card-box">
            <h4 class="header-title m-t-0 m-b-30">
                @ViewBag.Title
            </h4>
            <hr />
            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="row">
                <div class="col-md-12">
                    <div id="messagesTable2"></div>
                </div>
            </div>
        </div>
    </div><!-- end col -->
</div>



@section scriptsAdd {

    <!-- Jquery-Ui -->
    <script src="~/Content/assets/plugins/jquery-ui/jquery-ui.min.js"></script>

    <script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/bundles/datatables")
    <script>

        $(function () {
            // Declare a proxy to reference the hub.
            var notifications = $.connection.messagesHub;

            //debugger;
            // Create a function that the hub can call to broadcast messages.
            notifications.client.updateMessages = function () {
                getAllMessages2();
            };

            // Start the connection.
            $.connection.hub.start().done(function () {
                getAllMessages2();
            }).fail(function (e) {
                //alert(e);
            });
        });

        function getAllMessages2() {
            var tbl = $('#messagesTable2');
            $.ajax({
                url: '/home/GetFullMessages',
                contentType: 'application/html ; charset:utf-8',
                type: 'GET',
                dataType: 'html'
            }).success(function (result) {
                tbl.empty().append(result);
                SetUpTable();
            }).error(function () {

            });
        }

        function SetUpTable() {
                                  
            $('#itemContent2').DataTable({
                "pageLength": 25,
                "info": false,
                "oLanguage": {
                    "sSearch": "Tìm kiếm: ",
                    "sLengthMenu": "Hiển thị _MENU_ bản ghi",
                    "oPaginate": {
                        "sPrevious": "Trang trước",
                        "sNext": "Trang tiếp",
                        "sLast": "Trang cuối",
                        "sFirst": "Trang đầu",
                    }
                }
            });
        }
        
    </script>
}








